import{K as O,r as j,j as e,S as v}from"./app-C38ZAMrO.js";import{u as B,F as C,a as T,b as F,c as S,d as A,f as V,e as D,s as E,o as $,n as _}from"./form-DKFavece.js";import{B as u,c as z,t as c}from"./createLucideIcon-ADEuXVh1.js";import{C as K,a as q,b as G,c as J,d as Q}from"./card-CvHYkipP.js";import{L as b,I as L}from"./input-D_gxcHmv.js";import{L as U}from"./label-fq8opIoX.js";import{T as W,a as X,b as w,c as P}from"./tabs-j7gB8SyT.js";import{T as Y,a as Z,b as H,c as i,d as ee,e as r}from"./table-cUjOMkDa.js";import{D as se,b as ae,c as ne,d as te,e as le}from"./dialog-B58Mq984.js";import{V as d}from"./index-zRNEYPYS.js";import{P as R}from"./plus-C_OsLn3X.js";import{C as ce}from"./check-CN2lLgAm.js";import"./index-Cdysuist.js";import"./index-BZjVY62P.js";import"./index-BJyibHX0.js";import"./x-gOKHlL60.js";const ie=$({balance:_().min(0).max(1e6).default(0)}),re=$({balance:_().gt(0).max(1e6)});function Te({reseller:a}){var N;const o=O().props.auth.user,f=o==null?void 0:o.all_permissions.includes("RESELLER_ADD_BALANCE"),[k,m]=j.useState(!1),[y,t]=j.useState(!1),[l,g]=j.useState(!1),x=B({resolver:E(ie)}),p=B({resolver:E(re)}),I=async s=>{t(!0),v.post(route("users.setBalance",a==null?void 0:a.id),s,{onError:()=>{d.error("Error setting balance",{style:c})},onSuccess:()=>{d.success("Balance set",{style:c}),t(!1)},onFinish:()=>{t(!1)}})},M=async s=>{g(!0),m(!1),v.post(route("users.addBalance",a==null?void 0:a.id),s,{onError:()=>{d.error("Error setting balance",{style:c})},onSuccess:()=>{d.success("Balance set",{style:c}),t(!1)},onFinish:()=>{g(!1)}})};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{className:"mb-8",children:[e.jsxs(q,{children:[e.jsx(G,{children:"Balance Management"}),e.jsx(J,{children:"Manage reseller balance and view transaction history"})]}),e.jsxs(Q,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{className:"text-sm font-medium",children:"Current Balance"}),e.jsxs("p",{className:"text-3xl font-bold",children:["$",a==null?void 0:a.balance]})]}),e.jsxs(u,{className:"btn-primary",onClick:()=>m(!0),disabled:l||!f,children:[l?e.jsx(b,{className:"animate-spin"}):e.jsx(R,{}),"Add Balance"]})]}),e.jsxs(W,{defaultValue:"history",children:[e.jsxs(X,{className:"grid w-full grid-cols-2",children:[e.jsx(w,{value:"history",children:"Transaction History"}),e.jsx(w,{value:"set-balance",children:"Set Balance"})]}),e.jsx(P,{value:"history",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(H,{children:[e.jsx(i,{children:"Date"}),e.jsx(i,{children:"Type"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Balance"})]})}),e.jsx(ee,{children:(N=a==null?void 0:a.transactions)==null?void 0:N.map(s=>e.jsxs(H,{children:[e.jsx(r,{className:"font-mono text-sm",children:s.created_at.replace("T"," ").split(".")[0]}),e.jsx(r,{className:"capitalize",children:s.type}),e.jsxs(r,{className:z("",s.type==="credit"&&"text-green-600",s.type==="debit"&&"text-red-600",s.type==="set"&&"text-indigo-600"),children:[s.type!=="set"?s.type==="credit"?"+":"-":"","$",s.amount]}),e.jsxs(r,{children:["$",s.total]})]},s.id))})]})}),e.jsx(P,{value:"set-balance",children:e.jsx(C,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(I),className:"flex flex-col gap-4",children:[e.jsx(T,{control:x.control,name:"balance",render:({field:s})=>e.jsxs(F,{children:[e.jsx(S,{children:"New Balance"}),e.jsx(A,{children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"peer ps-6 pe-12",placeholder:"0.00",type:"number",step:"0.01",min:"0.00",...s,value:(s.value??0).toFixed(2),onChange:h=>{const n=parseFloat(h.target.value);s.onChange(isNaN(n)?0:n)}}),e.jsx("span",{className:"text-muted-foreground pointer-events-none absolute inset-y-0 start-0 flex items-center justify-center ps-3 text-sm peer-disabled:opacity-50",children:"$"})]})}),e.jsx(V,{children:"This will set the reseller's balance to the specified amount. To add balance use the 'Add Balance' option instead."}),e.jsx(D,{})]})}),e.jsx("div",{className:"flex",children:e.jsxs(u,{type:"submit",className:"btn-primary",disabled:y||!f,children:[y?e.jsx(b,{className:"animate-spin"}):e.jsx(ce,{}),"Set New Balance"]})})]})})})]})]})]}),e.jsx(se,{open:k,onOpenChange:m,children:e.jsxs(ae,{children:[e.jsxs(ne,{children:[e.jsx(te,{children:"Add Balance"}),e.jsx(le,{children:"Add funds to the reseller's account balance"})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsx("div",{className:"grid gap-2",children:e.jsx(C,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(M),className:"flex flex-col gap-4",children:[e.jsx(T,{control:p.control,name:"balance",render:({field:s})=>e.jsxs(F,{children:[e.jsx(S,{children:"Ammount to Add"}),e.jsx(A,{children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"peer ps-6 pe-12",placeholder:"0.00",type:"number",step:"0.01",min:"0.00",...s,value:(s.value??0).toFixed(2),onChange:h=>{const n=parseFloat(h.target.value);s.onChange(isNaN(n)?0:n)}}),e.jsx("span",{className:"text-muted-foreground pointer-events-none absolute inset-y-0 start-0 flex items-center justify-center ps-3 text-sm peer-disabled:opacity-50",children:"$"})]})}),e.jsx(D,{})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(u,{type:"submit",className:"btn-primary",disabled:l,children:[l?e.jsx(b,{className:"animate-spin"}):e.jsx(R,{}),"Add Balance"]})})]})})})})]})})]})}export{Te as ResellerBalance};
