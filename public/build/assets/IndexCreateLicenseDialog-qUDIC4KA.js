import{K as X,r as t,j as e,A as Z,t as O,S as ee}from"./app-T4LLqA-o.js";import{u as se,s as ae,F as le,a as d,b as c,c as i,d as o,e as x,f as E,o as ne,n as h,g as L}from"./form-QYiQPYc4.js";import{V as A}from"./index-BdR1ZkQo.js";import{B as g,f as re,d as te,a as ce,c as T,t as z}from"./button-4Fnn4Zm4.js";import{D as ie,a as oe,b as me,c as de,d as xe,e as je}from"./dialog-CArG7EL7.js";import{I as f}from"./input-BMxBlm1B.js";import{S as N,a as C,b as _,c as p,d as S}from"./select-D7m0JN0b.js";import{S as ue}from"./switch-BpKqDfYz.js";import{L as V}from"./label-D3IoOerA.js";import{P as y}from"./plus-f1ARs8iQ.js";import{c as he}from"./createLucideIcon-Del2cXXK.js";import{L as B}from"./loader-circle-Dv8pZFu_.js";import{C as fe,a as be,S as ge}from"./sticky-note-CYAZ9r0B.js";import{L as Ne}from"./layers-D1Hfan3E.js";import"./index-Bio6E3Lq.js";import"./index-C2Ig1X1a.js";import"./index-CXv7NyPn.js";import"./x-D_uMpEYG.js";import"./index-CDe0qDmA.js";import"./index-Ch3D5kJo.js";import"./index-DZ0ENFeq.js";import"./index-CKKOyhDv.js";import"./index-b-i2_jtq.js";import"./chevron-down-DcCCAuOU.js";import"./check-B8Ujda_Q.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],I=he("Tag",Ce),_e=ne({app_id:h(),duration_unit:L(),duration_value:h().min(1),note:L(),bulk_amount:h().min(1).max(256),time_option:h()});function qe({applications:P,timeOptions:m}){const s=X().props.auth.user,j=(s==null?void 0:s.role)==="reseller",$=s==null?void 0:s.all_permissions.includes("KEYS_CREATE"),H=(s==null?void 0:s.license_count)>=(s==null?void 0:s.subscription.max_licenses),R=(s==null?void 0:s.subscription.max_licenses)-(s==null?void 0:s.license_count),[K,M]=t.useState(!1),[k,v]=t.useState(!1),[u,U]=t.useState(!1),[W,Y]=t.useState(0),[F,q]=t.useState(!1),[G,J]=t.useState(null),r=se({resolver:ae(_e),defaultValues:{duration_unit:"days",duration_value:1,bulk_amount:1}});t.useEffect(()=>{j||r.setValue("time_option",1)});const Q=async n=>{v(!0);const a={...n,is_bulk:u};ee.post(route("licenses.store"),a,{onError:()=>{A.error("Error creating license",{style:z})},onSuccess:()=>{A.success("License created",{style:z})},onFinish:()=>v(!1)})};if(j){const n=r.watch("time_option"),a=r.watch("bulk_amount");t.useEffect(()=>{var w;const l=u?a:1,D=((w=m==null?void 0:m.find(b=>(b==null?void 0:b.id)===n))==null?void 0:w.cost)*l||0;Y(Number(D).toFixed(2)),q(D>(s==null?void 0:s.balance))},[n,a,u])}return console.log(s),e.jsx(e.Fragment,{children:e.jsx(Z,{data:"applications",fallback:e.jsxs(g,{className:"btn-primary",disabled:!0,children:[" ",e.jsx(y,{}),"New license"]}),children:e.jsxs(ie,{open:K,onOpenChange:M,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(g,{className:"btn-primary",disabled:!$||H,children:[e.jsx(y,{}),"New license"," (",s==null?void 0:s.license_count,"/",s==null?void 0:s.subscription.max_licenses,")"]})}),e.jsxs(me,{className:"bg-zinc-950 border border-zinc-900",children:[e.jsxs(de,{children:[e.jsx(xe,{children:"Create new license"}),e.jsx(je,{})]}),e.jsx(le,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Q),className:"flex flex-col gap-4",children:[e.jsx(d,{control:r.control,name:"app_id",render:({field:n})=>e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(I,{className:"inline mr-0.5",size:14}),"Application *"]}),e.jsxs(N,{onValueChange:a=>{const l=Number(a);n.onChange(l),J(l)},children:[e.jsx(o,{children:e.jsx(C,{children:e.jsx(_,{placeholder:"Select an application"})})}),e.jsx(p,{children:P.map(a=>e.jsx(S,{value:String(a==null?void 0:a.id),children:a==null?void 0:a.name},a==null?void 0:a.id))})]}),e.jsx(x,{})]})}),j?e.jsx(O,{data:"timeOptions",fallback:e.jsxs("div",{className:"flex mt-2",children:[e.jsx(f,{disabled:!0,className:"flex-1"}),e.jsx(B,{className:"animate-spin"})]}),children:e.jsx(d,{control:r.control,name:"time_option",render:({field:n})=>{const a=m==null?void 0:m.filter(l=>l.reseller_app.app_id===G);return e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(I,{className:"inline mr-0.5",size:14}),"Time Option *"]}),e.jsxs(N,{onValueChange:l=>n.onChange(Number(l)),children:[e.jsx(o,{children:e.jsx(C,{children:e.jsx(_,{placeholder:"Select a time option"})})}),e.jsx(p,{children:a==null?void 0:a.map(l=>e.jsxs(S,{value:String(l==null?void 0:l.id),children:[l==null?void 0:l.name," ",`(${re(l==null?void 0:l.duration)})`," - $",l==null?void 0:l.cost]},l==null?void 0:l.id))})]}),e.jsx(x,{})]})}})}):e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsx(d,{control:r.control,name:"duration_unit",render:({field:n})=>e.jsxs(c,{className:"flex flex-col flex-1 mt-2.5",children:[e.jsxs(i,{children:[e.jsx(fe,{className:"inline mb-0.5 mr-1",size:14}),"Duration Unit *"]}),e.jsxs(N,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(o,{children:e.jsx(C,{children:e.jsx(_,{placeholder:"Select a time unit"})})}),e.jsx(p,{children:te.map(a=>e.jsx(S,{value:a.value,children:a.label},a.value))})]}),e.jsx(x,{})]})}),e.jsx(d,{control:r.control,name:"duration_value",render:({field:n})=>e.jsxs(c,{className:"flex-1",children:[e.jsxs(i,{children:[e.jsx(be,{className:"inline mb-0.5 mr-1",size:14}),"Duration Value *"]}),e.jsx(o,{children:e.jsx(f,{placeholder:"Enter a duration value",type:"number",...n,onChange:a=>n.onChange(Number(a.target.value)||0)})}),e.jsx(x,{})]})})]}),e.jsx(d,{control:r.control,name:"note",render:({field:n})=>e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(ge,{className:"inline mb-0.5 mr-1",size:14}),"Note"]}),e.jsx(o,{children:e.jsx(f,{placeholder:"Frank's license",type:"text",...n})}),e.jsx(E,{children:"Add a note to better identify this license"}),e.jsx(x,{})]})}),e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{children:"Bulk create"}),e.jsx(E,{children:"Create multiple licenses at once"})]}),e.jsx(o,{children:e.jsx(ue,{checked:u,onCheckedChange:U})})]}),e.jsx(d,{control:r.control,name:"bulk_amount",render:({field:n})=>e.jsxs(c,{className:ce("flex-1",u?"block":"hidden"),children:[e.jsxs(i,{children:[e.jsx(Ne,{className:"inline mb-0.5 mr-1",size:14}),"Bulk Amount *"]}),e.jsx(o,{children:e.jsx(f,{placeholder:"How many licenses you want to create?",type:"number",min:1,max:R,...n,onChange:a=>n.onChange(Number(a.target.value)||0)})}),e.jsx(x,{})]})}),e.jsxs("div",{className:T("flex justify-end items-center",j?"justify-between":"justify-end"),children:[j&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(V,{className:"text-xs font-thin text-zinc-300",children:["Your Balance: $",s==null?void 0:s.balance]}),e.jsxs(V,{className:T("text-lg",F?"text-red-400":"text-emerald-400"),children:["Total Cost:$",W]})]}),e.jsx(g,{type:"submit",className:"btn-primary",disabled:k||F,children:k?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"animate-spin"}),"Creating license..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{})," Create license"]})})]})]})})]})]})})})}export{qe as IndexCreateLicenseDialog};
