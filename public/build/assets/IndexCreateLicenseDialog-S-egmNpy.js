import{K as J,r as t,j as e,A as Q,t as X,S as Z}from"./app-FXJ6jLQe.js";import{u as O,s as ee,F as se,a as m,b as c,c as i,d as o,e as x,f as E,o as ae,n as h,g as A}from"./form-ADAfqGEn.js";import{V as T}from"./index-Dn7W_-lm.js";import{B as g,f as le,d as re,a as ne,c as z,t as L}from"./button-Ce_b9ygY.js";import{D as te,a as ce,b as ie,c as oe,d as de,e as me}from"./dialog-eQaAcXWz.js";import{I as f}from"./input-DC-sq8Ns.js";import{S as N,a as C,b as S,c as y,d as _}from"./select-DebCzC2U.js";import{S as xe}from"./switch-D5QyO_oG.js";import{L as V}from"./label-CMF0eOr7.js";import{P as k}from"./plus-DvWOsv4y.js";import{c as ue}from"./createLucideIcon-BgzLVGAg.js";import{L as B}from"./loader-circle-Cu0U8Rup.js";import{C as je,a as he,S as fe}from"./sticky-note-BCTbWxrN.js";import{L as be}from"./layers-C76No4BZ.js";import"./index-Bhapx3qy.js";import"./x-DSSjkk1K.js";import"./index-DenDO0bJ.js";import"./index-Bo_VaOlX.js";import"./index-Bhsnbx5j.js";import"./index-BAmNiSFU.js";import"./index-DHqSERin.js";import"./check-B6cm8EDH.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],I=ue("Tag",ge),Ne=ae({app_id:h(),duration_unit:A(),duration_value:h().min(1),note:A(),bulk_amount:h().min(1).max(256),time_option:h()});function Ke({applications:P,timeOptions:d}){const r=J().props.auth.user,u=(r==null?void 0:r.role)==="reseller",$=r==null?void 0:r.all_permissions.includes("KEYS_CREATE"),[H,R]=t.useState(!1),[p,v]=t.useState(!1),[j,K]=t.useState(!1),[M,U]=t.useState(0),[F,W]=t.useState(!1),[Y,q]=t.useState(null),n=O({resolver:ee(Ne),defaultValues:{duration_unit:"days",duration_value:1,bulk_amount:1}});t.useEffect(()=>{u||n.setValue("time_option",1)});const G=async l=>{v(!0);const s={...l,is_bulk:j};Z.post(route("licenses.store"),s,{onError:()=>{T.error("Error creating license",{style:L})},onSuccess:()=>{T.success("License created",{style:L})},onFinish:()=>v(!1)})};if(u){const l=n.watch("time_option"),s=n.watch("bulk_amount");t.useEffect(()=>{var w;const a=j?s:1,D=((w=d==null?void 0:d.find(b=>(b==null?void 0:b.id)===l))==null?void 0:w.cost)*a||0;U(Number(D).toFixed(2)),W(D>(r==null?void 0:r.balance))},[l,s,j])}return e.jsx(e.Fragment,{children:e.jsx(Q,{data:"applications",fallback:e.jsxs(g,{className:"btn-primary",disabled:!0,children:[" ",e.jsx(k,{}),"New license"]}),children:e.jsxs(te,{open:H,onOpenChange:R,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(g,{className:"btn-primary",disabled:!$,children:[e.jsx(k,{}),"New license"]})}),e.jsxs(ie,{className:"bg-zinc-950 border border-zinc-900",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Create new license"}),e.jsx(me,{})]}),e.jsx(se,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(G),className:"flex flex-col gap-4",children:[e.jsx(m,{control:n.control,name:"app_id",render:({field:l})=>e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(I,{className:"inline mr-0.5",size:14}),"Application *"]}),e.jsxs(N,{onValueChange:s=>{const a=Number(s);l.onChange(a),q(a)},children:[e.jsx(o,{children:e.jsx(C,{children:e.jsx(S,{placeholder:"Select an application"})})}),e.jsx(y,{children:P.map(s=>e.jsx(_,{value:String(s==null?void 0:s.id),children:s==null?void 0:s.name},s==null?void 0:s.id))})]}),e.jsx(x,{})]})}),u?e.jsx(X,{data:"timeOptions",fallback:e.jsxs("div",{className:"flex mt-2",children:[e.jsx(f,{disabled:!0,className:"flex-1"}),e.jsx(B,{className:"animate-spin"})]}),children:e.jsx(m,{control:n.control,name:"time_option",render:({field:l})=>{const s=d==null?void 0:d.filter(a=>a.reseller_app.app_id===Y);return e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(I,{className:"inline mr-0.5",size:14}),"Time Option *"]}),e.jsxs(N,{onValueChange:a=>l.onChange(Number(a)),children:[e.jsx(o,{children:e.jsx(C,{children:e.jsx(S,{placeholder:"Select a time option"})})}),e.jsx(y,{children:s==null?void 0:s.map(a=>e.jsxs(_,{value:String(a==null?void 0:a.id),children:[a==null?void 0:a.name," ",`(${le(a==null?void 0:a.duration)})`," - $",a==null?void 0:a.cost]},a==null?void 0:a.id))})]}),e.jsx(x,{})]})}})}):e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsx(m,{control:n.control,name:"duration_unit",render:({field:l})=>e.jsxs(c,{className:"flex flex-col flex-1 mt-2.5",children:[e.jsxs(i,{children:[e.jsx(je,{className:"inline mb-0.5 mr-1",size:14}),"Duration Unit *"]}),e.jsxs(N,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(o,{children:e.jsx(C,{children:e.jsx(S,{placeholder:"Select a time unit"})})}),e.jsx(y,{children:re.map(s=>e.jsx(_,{value:s.value,children:s.label},s.value))})]}),e.jsx(x,{})]})}),e.jsx(m,{control:n.control,name:"duration_value",render:({field:l})=>e.jsxs(c,{className:"flex-1",children:[e.jsxs(i,{children:[e.jsx(he,{className:"inline mb-0.5 mr-1",size:14}),"Duration Value *"]}),e.jsx(o,{children:e.jsx(f,{placeholder:"Enter a duration value",type:"number",...l,onChange:s=>l.onChange(Number(s.target.value)||0)})}),e.jsx(x,{})]})})]}),e.jsx(m,{control:n.control,name:"note",render:({field:l})=>e.jsxs(c,{children:[e.jsxs(i,{children:[e.jsx(fe,{className:"inline mb-0.5 mr-1",size:14}),"Note"]}),e.jsx(o,{children:e.jsx(f,{placeholder:"Frank's license",type:"text",...l})}),e.jsx(E,{children:"Add a note to better identify this license"}),e.jsx(x,{})]})}),e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{children:"Bulk create"}),e.jsx(E,{children:"Create multiple licenses at once"})]}),e.jsx(o,{children:e.jsx(xe,{checked:j,onCheckedChange:K})})]}),e.jsx(m,{control:n.control,name:"bulk_amount",render:({field:l})=>e.jsxs(c,{className:ne("flex-1",j?"block":"hidden"),children:[e.jsxs(i,{children:[e.jsx(be,{className:"inline mb-0.5 mr-1",size:14}),"Bulk Amount *"]}),e.jsx(o,{children:e.jsx(f,{placeholder:"How many licenses you want to create?",type:"number",min:1,max:256,...l,onChange:s=>l.onChange(Number(s.target.value)||0)})}),e.jsx(x,{})]})}),e.jsxs("div",{className:z("flex justify-end items-center",u?"justify-between":"justify-end"),children:[u&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(V,{className:"text-xs font-thin text-zinc-300",children:["Your Balance: $",r==null?void 0:r.balance]}),e.jsxs(V,{className:z("text-lg",F?"text-red-400":"text-emerald-400"),children:["Total Cost:$",M]})]}),e.jsx(g,{type:"submit",className:"btn-primary",disabled:p||F,children:p?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"animate-spin"}),"Creating license..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{})," Create license"]})})]})]})})]})]})})})}export{Ke as IndexCreateLicenseDialog};
