import{K as k,r as h,j as e,S as L}from"./app-yL2iGMts.js";import{V as j}from"./index-C1riV4w8.js";import{u as T,s as _,F as I,a as n,b as t,c as g,d as i,e as l,o as M,h as z,g as c}from"./form-BhzjBLJg.js";import{B as f,j as A,p as V,k as O,t as b}from"./button-CxvMOh2a.js";import{D as U,a as B,b as G,c as H,d as K,e as W}from"./dialog-DzQRV4Sa.js";import{I as C}from"./input-D6_S4_wJ.js";import{C as Z}from"./checkbox-DVDayTIW.js";import{L as y}from"./label-BAR_9Z-w.js";import{P as N}from"./plus-DsW4Zf-Y.js";import{R as $}from"./refresh-ccw-BMCuNJBU.js";import{L as q}from"./loader-circle-92hIJbPX.js";import"./index-wIQhi2Hj.js";import"./index-DyMD7BVC.js";import"./index-C7ENykKL.js";import"./x-DbsyahKQ.js";import"./createLucideIcon-Dwzquaww.js";import"./index-BYQnBW3-.js";import"./index-CzELzSBS.js";import"./check-CfB3bmT4.js";const J=M({name:c().min(6).max(24).regex(/^[a-zA-Z0-9]+$/,"Username must be alphanumeric"),password:c().min(8).max(64),permissions:z(c()).optional()});function je(){const s=k().props.auth.user,v=s==null?void 0:s.all_permissions.includes("MANAGER_CREATE"),w=(s==null?void 0:s.managers_count)>=(s==null?void 0:s.subscription.max_managers),[F,m]=h.useState(!1),[d,p]=h.useState(!1),a=T({resolver:_(J),defaultValues:{permissions:[]}}),S=async r=>{p(!0),L.post(route("users.storeManager"),r,{onError:()=>{j.error("Error creating user",{style:b})},onSuccess:()=>{j.success("User created",{style:b}),m(!1)},onFinish:()=>{p(!1)}})},P=()=>{const r=O();a.setValue("password",r)};return console.log(s),e.jsxs(U,{open:F,onOpenChange:m,children:[e.jsx(B,{asChild:!0,children:e.jsxs(f,{className:"btn-primary hover:bg-indigo-700",disabled:!v||w,children:[e.jsx(N,{}),"New manager"," (",s==null?void 0:s.managers_count,"/",s==null?void 0:s.subscription.max_managers,")"]})}),e.jsxs(G,{className:"bg-zinc-950 border border-zinc-900",children:[e.jsxs(H,{children:[e.jsx(K,{children:"Create new manager"}),e.jsx(W,{})]}),e.jsx(I,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(S),className:"flex flex-col gap-4",children:[e.jsx(n,{control:a.control,name:"name",render:({field:r})=>e.jsxs(t,{children:[e.jsx(g,{children:"Username *"}),e.jsx(i,{children:e.jsx(C,{placeholder:"Enter a username",type:"text",...r})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"password",render:({field:r})=>e.jsxs(t,{children:[e.jsx(g,{children:"Password *"}),e.jsx(i,{children:e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"pe-9",placeholder:"Enter a password",...r}),e.jsx("button",{type:"button",className:"absolute inset-y-0 end-0 flex h-full w-9 items-center justify-center rounded-e-lg border border-transparent text-muted-foreground/80 outline-offset-2 transition-colors hover:text-foreground focus-visible:outline focus-visible:outline-2 focus-visible:outline-ring/70 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50",onClick:P,children:e.jsx($,{size:16,strokeWidth:2,"aria-hidden":"true"})})]})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"permissions",render:({field:r})=>e.jsxs(e.Fragment,{children:[e.jsx(y,{children:"Permissions"}),e.jsxs(t,{className:"flex flex-col space-y-2 rounded-md border p-4",children:[e.jsx(i,{children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:A.map((o,x)=>{var u;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{checked:((u=r.value)==null?void 0:u.includes(o))||!1,onCheckedChange:D=>{const E=D?[...r.value||[],o]:(r.value||[]).filter(R=>R!==o);r.onChange(E)}},x),e.jsx(y,{className:"uppercase text-xs",children:V(o)})]},x)})})}),e.jsx(l,{})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(f,{type:"submit",className:"btn-primary",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"animate-spin"}),"Creating user..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{})," Create user"]})})})]})})]})]})}export{je as CreateManagerDialog};
