import{r as t,j as e,K as xe,A as he,t as je,S as M}from"./app-BTBLTgKa.js";import{u as q,F as fe,a as R,b as D,c as w,d as E,e as O,s as K,o as ie,n as P,g as L}from"./form-Ewck4cr5.js";import{P as B,u as ge,f as Ce,B as C,d as be,t as b}from"./createLucideIcon-Dk4g4Rfc.js";import{C as ve,a as Ne,b as ye,c as Se,d as Te,e as Ae}from"./card-CUhwYfK6.js";import{T as _e,a as Pe,b as J,c as k,d as Fe,e as I}from"./table-Cv9fAIzO.js";import{a as Re,c as De,u as we,b as Ee,P as Oe,e as ke,V as v}from"./index-C0Aybrov.js";import{D as Q,b as W,c as X,d as Y,e as Z,f as Ie}from"./dialog-DcRx5_hZ.js";import{L as _,I as V}from"./input-DPBk8N_M.js";import{C as Le,S as ee,a as se,b as ne,c as te,d as ae,e as Me}from"./select-D13dZe9U.js";import{P as Ve}from"./package-Bg3_ZOXw.js";import{T as $e}from"./trash-CPK-TJTn.js";import{P as $}from"./plus-562kTAxb.js";import{C as Be}from"./check-DyFLvgFN.js";import"./label-8Biq_GbJ.js";import"./index-Uk3LIZDJ.js";import"./x-Dpj60ZH6.js";import"./index-DuTKQBgG.js";import"./index-cyAClCp9.js";import"./index-9Zp9f-9W.js";import"./index-DqEWQkQn.js";import"./index-CycH6tgb.js";var H="Collapsible",[He,gs]=De(H),[Ge,G]=He(H),re=t.forwardRef((n,c)=>{const{__scopeCollapsible:o,open:a,defaultOpen:i,disabled:d,onOpenChange:m,...u}=n,[f=!1,p]=Re({prop:a,defaultProp:i,onChange:m});return e.jsx(Ge,{scope:o,disabled:d,contentId:we(),open:f,onOpenToggle:t.useCallback(()=>p(h=>!h),[p]),children:e.jsx(B.div,{"data-state":z(f),"data-disabled":d?"":void 0,...u,ref:c})})});re.displayName=H;var oe="CollapsibleTrigger",le=t.forwardRef((n,c)=>{const{__scopeCollapsible:o,...a}=n,i=G(oe,o);return e.jsx(B.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":z(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...a,ref:c,onClick:Ee(n.onClick,i.onOpenToggle)})});le.displayName=oe;var U="CollapsibleContent",ce=t.forwardRef((n,c)=>{const{forceMount:o,...a}=n,i=G(U,n.__scopeCollapsible);return e.jsx(Oe,{present:o||i.open,children:({present:d})=>e.jsx(Ue,{...a,ref:c,present:d})})});ce.displayName=U;var Ue=t.forwardRef((n,c)=>{const{__scopeCollapsible:o,present:a,children:i,...d}=n,m=G(U,o),[u,f]=t.useState(a),p=t.useRef(null),h=ge(c,p),F=t.useRef(0),N=F.current,y=t.useRef(0),S=y.current,g=m.open||u,T=t.useRef(g),j=t.useRef(void 0);return t.useEffect(()=>{const r=requestAnimationFrame(()=>T.current=!1);return()=>cancelAnimationFrame(r)},[]),ke(()=>{const r=p.current;if(r){j.current=j.current||{transitionDuration:r.style.transitionDuration,animationName:r.style.animationName},r.style.transitionDuration="0s",r.style.animationName="none";const A=r.getBoundingClientRect();F.current=A.height,y.current=A.width,T.current||(r.style.transitionDuration=j.current.transitionDuration,r.style.animationName=j.current.animationName),f(a)}},[m.open,a]),e.jsx(B.div,{"data-state":z(m.open),"data-disabled":m.disabled?"":void 0,id:m.contentId,hidden:!g,...d,ref:h,style:{"--radix-collapsible-content-height":N?`${N}px`:void 0,"--radix-collapsible-content-width":S?`${S}px`:void 0,...n.style},children:g&&i})});function z(n){return n?"open":"closed"}var ze=re;const qe=ze,Ke=le,Je=ce,Qe=ie({name:L().max(24),duration_unit:L(),duration_value:P().gt(0),cost:P().gt(0).default(0)}),We=ie({name:L().max(24),duration_unit:L(),duration_value:P().gt(0),cost:P().gt(0).default(0),reseller_app_id:P().gt(0)});function Cs({reseller:n,applications:c,resellerApps:o}){q({resolver:K(Qe)});const a=q({resolver:K(We)}),i=xe().props.auth.user,d=i==null?void 0:i.all_permissions.includes("RESELLER_UPDATE"),[m,u]=t.useState(!1),[f,p]=t.useState(!1),[h,F]=t.useState(null),[N,y]=t.useState(null),[S,g]=t.useState(!1),[T,j]=t.useState(!1),[r,A]=t.useState(!1),de=async s=>{j(!0),p(!1),M.post(route("resellers.addTimeType"),{...s,reseller_app_id:h==null?void 0:h.id},{preserveScroll:!0,onError:()=>{v.error("Error adding time option",{style:b})},onSuccess:()=>{v.success("Time option added",{style:b})},onFinish:()=>{j(!1)}})},me=s=>{A(!0),M.delete(route("resellers.deleteTimeType",s.id),{preserveScroll:!0,onError:()=>{v.error("Error deleting time option",{style:b})},onSuccess:()=>{v.success("Time option deleted",{style:b})},onFinish:()=>{A(!1)}})},pe=()=>{g(!0),u(!1);const s={app_id:N,user_id:n==null?void 0:n.id};M.post(route("resellers.addApp"),s,{preserveScroll:!0,onError:()=>{v.error("Error assigning application",{style:b})},onSuccess:()=>{v.success("Application assigned",{style:b})},onFinish:()=>{g(!1),y(null)}})},ue=s=>{F(s),p(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(ve,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Application Access"}),e.jsx(Se,{children:"Manage reseller access to applications and license creation options"})]}),e.jsx(he,{data:"resellerApps",fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-indigo-600"})}),children:e.jsx(Te,{className:"space-y-4",children:o==null?void 0:o.map(s=>{var l;return e.jsxs(qe,{className:"border rounded-md",children:[e.jsxs(Ke,{className:"flex items-center justify-between w-full p-4 font-medium",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),s.app.name]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Le,{className:"h-4 w-4 transition-transform duration-200"})})]}),e.jsx(Je,{className:"px-4 pb-4 pt-0 space-y-2",children:e.jsxs(e.Fragment,{children:[e.jsxs(_e,{children:[e.jsx(Pe,{children:e.jsxs(J,{children:[e.jsx(k,{children:"Name"}),e.jsx(k,{children:"Duration (days)"}),e.jsx(k,{children:"Cost"}),e.jsx(k,{className:"text-right",children:"Action"})]})}),e.jsx(Fe,{children:(l=s.time_types)==null?void 0:l.map(x=>e.jsxs(J,{children:[e.jsx(I,{children:x.name}),e.jsx(I,{children:Ce(x.duration)}),e.jsxs(I,{children:["$",x.cost]}),e.jsx(I,{className:"text-right",children:e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>me(x),disabled:r||!d,children:r?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx($e,{className:"h-4 w-4 text-rose-600"})})})]},x.id))})]}),e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>ue(s),disabled:T||!d,children:[T?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx($,{className:"h-4 w-4 mr-2"}),"Add Time Option"]})]})})]},s.id)})})}),e.jsx(Ae,{children:e.jsxs(C,{className:"btn-primary",onClick:()=>u(!0),disabled:S||!d,children:[S?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx($,{}),"Assign Application"]})})]}),e.jsx(Q,{open:f,onOpenChange:p,children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Add Time Option"}),e.jsx(Z,{children:"Add a new time option"})]}),e.jsx(fe,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(de),className:"flex flex-col gap-4",children:[e.jsx(R,{control:a.control,name:"name",render:({field:s})=>e.jsxs(D,{children:[e.jsx(w,{children:"Name *"}),e.jsx(E,{children:e.jsx(V,{placeholder:"e.g., 1 Month",type:"text",...s})}),e.jsx(O,{})]})}),e.jsx(R,{control:a.control,name:"duration_unit",render:({field:s})=>e.jsxs(D,{className:"flex flex-col flex-1 mt-2.5",children:[e.jsx(w,{children:"Duration Unit *"}),e.jsxs(ee,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(E,{children:e.jsx(se,{children:e.jsx(ne,{placeholder:"Select a time unit"})})}),e.jsx(te,{children:be.map(l=>e.jsx(ae,{value:l.value,children:l.label},l.value))})]}),e.jsx(O,{})]})}),e.jsx(R,{control:a.control,name:"duration_value",render:({field:s})=>e.jsxs(D,{className:"flex-1",children:[e.jsx(w,{children:"Duration Value *"}),e.jsx(E,{children:e.jsx(V,{placeholder:"Enter a duration value",type:"number",...s,onChange:l=>s.onChange(Number(l.target.value)||0)})}),e.jsx(O,{})]})}),e.jsx(R,{control:a.control,name:"cost",render:({field:s})=>e.jsxs(D,{children:[e.jsx(w,{children:"Cost *"}),e.jsx(E,{children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"peer ps-6 pe-12",placeholder:"0.00",type:"number",step:"0.01",min:"0.00",...s,value:(s.value??0).toFixed(2),onChange:l=>{const x=parseFloat(l.target.value);s.onChange(isNaN(x)?0:x)}}),e.jsx("span",{className:"text-muted-foreground pointer-events-none absolute inset-y-0 start-0 flex items-center justify-center ps-3 text-sm peer-disabled:opacity-50",children:"$"})]})}),e.jsx(O,{})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(C,{type:"submit",className:"btn-primary",children:[e.jsx($,{}),"Confirm"]})})]})})]})}),e.jsx(Q,{open:m,onOpenChange:u,children:e.jsx(W,{children:e.jsx(je,{data:"applications",fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-indigo-600"})}),children:e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Assign Application"}),e.jsxs(Z,{children:["Assign an application to ",n==null?void 0:n.name]})]}),e.jsxs(ee,{onValueChange:y,children:[e.jsx(se,{children:e.jsx(ne,{placeholder:"Select an application"})}),e.jsx(te,{children:e.jsx(Me,{children:c==null?void 0:c.filter(s=>!o.some(l=>l.app_id===s.id)).map(s=>e.jsx(ae,{value:s.id,children:s.name},s.id))})})]}),e.jsxs(Ie,{children:[e.jsx(C,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(C,{className:"btn-primary",onClick:pe,disabled:N===null,children:[e.jsx(Be,{}),"Confirm"]})]})]})})})})]})}export{Cs as ResellerApplications};
