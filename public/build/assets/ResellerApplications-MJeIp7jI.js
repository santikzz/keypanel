import{K as ae,r as i,j as e,A as ne,t as ie,S as T}from"./app-2b23YrnK.js";import{u as te,F as re,a as p,b as h,c as j,d as u,e as g,s as le,o as oe,n as L,g as R}from"./form-OofxsTPd.js";import{f as ce,B as l,d as de,t as o}from"./button-BbHsYz03.js";import{C as me,a as xe,c as pe,d as he,b as je,e as ue}from"./card-DZnqfez5.js";import{T as ge,a as fe,b as H,c as f,d as Ce,e as C}from"./table-cb4ERKQS.js";import{C as be,a as Ne,b as ye}from"./collapsible-CTMgmbvl.js";import{D as I,b as M,c as B,d as U,e as z,f as Se}from"./dialog-DbC6CjyB.js";import{I as A}from"./input-CbC5UnEm.js";import{S as $,a as G,b as K,c as q,d as J,e as ve}from"./select-uurJL92s.js";import{V as c}from"./index-DsxUMH9m.js";import{P as Te}from"./package-CAactlcO.js";import{C as Ae}from"./chevron-down-DC8akCjh.js";import{L as d}from"./loader-circle-D1mA8ziZ.js";import{T as Fe}from"./trash-D5w3rG0H.js";import{P as F}from"./plus-8_r9ynz2.js";import{C as De}from"./check-BvbNIJsF.js";import"./label-BzUgwGFy.js";import"./index-vd-RcrO-.js";import"./index-C-2hyLgg.js";import"./x-CaNmTljD.js";import"./createLucideIcon-xaTbvGYt.js";import"./index-D3t0k-bs.js";import"./index-By43F1ol.js";import"./index-D_YexNjV.js";import"./index-BjMsiUev.js";import"./index-ea57ieYU.js";const we=oe({name:R().max(24),duration_unit:R(),duration_value:L().gt(0),cost:L().gt(0).default(0)});function as({reseller:t,applications:b,resellerApps:m}){const r=te({resolver:le(we)}),N=ae().props.auth.user,y=N==null?void 0:N.all_permissions.includes("RESELLER_UPDATE"),[Q,x]=i.useState(!1),[W,S]=i.useState(!1),[v,X]=i.useState(null),[D,w]=i.useState(null),[E,O]=i.useState(!1),[_,P]=i.useState(!1),[k,V]=i.useState(!1),Y=async s=>{P(!0),S(!1),T.post(route("resellers.addTimeType"),{...s,reseller_app_id:v==null?void 0:v.id},{preserveScroll:!0,onError:()=>{c.error("Error adding time option",{style:o})},onSuccess:()=>{c.success("Time option added",{style:o})},onFinish:()=>{P(!1)}})},Z=s=>{V(!0),T.delete(route("resellers.deleteTimeType",s.id),{preserveScroll:!0,onError:()=>{c.error("Error deleting time option",{style:o})},onSuccess:()=>{c.success("Time option deleted",{style:o})},onFinish:()=>{V(!1)}})},ee=()=>{O(!0),x(!1);const s={app_id:D,user_id:t==null?void 0:t.id};T.post(route("resellers.addApp"),s,{preserveScroll:!0,onError:()=>{c.error("Error assigning application",{style:o})},onSuccess:()=>{c.success("Application assigned",{style:o})},onFinish:()=>{O(!1),w(null)}})},se=s=>{X(s),S(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Application Access"}),e.jsx(he,{children:"Manage reseller access to applications and license creation options"})]}),e.jsx(ne,{data:"resellerApps",fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(d,{className:"h-8 w-8 animate-spin text-indigo-600"})}),children:e.jsx(je,{className:"space-y-4",children:m==null?void 0:m.map(s=>{var a;return e.jsxs(be,{className:"border rounded-md",children:[e.jsxs(Ne,{className:"flex items-center justify-between w-full p-4 font-medium",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),s.app.name]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Ae,{className:"h-4 w-4 transition-transform duration-200"})})]}),e.jsx(ye,{className:"px-4 pb-4 pt-0 space-y-2",children:e.jsxs(e.Fragment,{children:[e.jsxs(ge,{children:[e.jsx(fe,{children:e.jsxs(H,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Duration (days)"}),e.jsx(f,{children:"Cost"}),e.jsx(f,{className:"text-right",children:"Action"})]})}),e.jsx(Ce,{children:(a=s.time_types)==null?void 0:a.map(n=>e.jsxs(H,{children:[e.jsx(C,{children:n.name}),e.jsx(C,{children:ce(n.duration)}),e.jsxs(C,{children:["$",n.cost]}),e.jsx(C,{className:"text-right",children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>Z(n),disabled:k||!y,children:k?e.jsx(d,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Fe,{className:"h-4 w-4 text-rose-600"})})})]},n.id))})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>se(s),disabled:_||!y,children:[_?e.jsx(d,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(F,{className:"h-4 w-4 mr-2"}),"Add Time Option"]})]})})]},s.id)})})}),e.jsx(ue,{children:e.jsxs(l,{className:"btn-primary",onClick:()=>x(!0),disabled:E||!y,children:[E?e.jsx(d,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(F,{}),"Assign Application"]})})]}),e.jsx(I,{open:W,onOpenChange:S,children:e.jsxs(M,{children:[e.jsxs(B,{children:[e.jsx(U,{children:"Add Time Option"}),e.jsx(z,{children:"Add a new time option"})]}),e.jsx(re,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Y),className:"flex flex-col gap-4",children:[e.jsx(p,{control:r.control,name:"name",render:({field:s})=>e.jsxs(h,{children:[e.jsx(j,{children:"Name *"}),e.jsx(u,{children:e.jsx(A,{placeholder:"e.g., 1 Month",type:"text",...s})}),e.jsx(g,{})]})}),e.jsx(p,{control:r.control,name:"duration_unit",render:({field:s})=>e.jsxs(h,{className:"flex flex-col flex-1 mt-2.5",children:[e.jsx(j,{children:"Duration Unit *"}),e.jsxs($,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(u,{children:e.jsx(G,{children:e.jsx(K,{placeholder:"Select a time unit"})})}),e.jsx(q,{children:de.map(a=>e.jsx(J,{value:a.value,children:a.label},a.value))})]}),e.jsx(g,{})]})}),e.jsx(p,{control:r.control,name:"duration_value",render:({field:s})=>e.jsxs(h,{className:"flex-1",children:[e.jsx(j,{children:"Duration Value *"}),e.jsx(u,{children:e.jsx(A,{placeholder:"Enter a duration value",type:"number",...s,onChange:a=>s.onChange(Number(a.target.value)||0)})}),e.jsx(g,{})]})}),e.jsx(p,{control:r.control,name:"cost",render:({field:s})=>e.jsxs(h,{children:[e.jsx(j,{children:"Cost *"}),e.jsx(u,{children:e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"peer ps-6 pe-12",placeholder:"0.00",type:"number",step:"0.01",min:"0.00",...s,value:(s.value??0).toFixed(2),onChange:a=>{const n=parseFloat(a.target.value);s.onChange(isNaN(n)?0:n)}}),e.jsx("span",{className:"text-muted-foreground pointer-events-none absolute inset-y-0 start-0 flex items-center justify-center ps-3 text-sm peer-disabled:opacity-50",children:"$"})]})}),e.jsx(g,{})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(l,{type:"submit",className:"btn-primary",children:[e.jsx(F,{}),"Confirm"]})})]})})]})}),e.jsx(I,{open:Q,onOpenChange:x,children:e.jsx(M,{children:e.jsx(ie,{data:"applications",fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(d,{className:"h-8 w-8 animate-spin text-indigo-600"})}),children:e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(U,{children:"Assign Application"}),e.jsxs(z,{children:["Assign an application to ",t==null?void 0:t.name]})]}),e.jsxs($,{onValueChange:w,children:[e.jsx(G,{children:e.jsx(K,{placeholder:"Select an application"})}),e.jsx(q,{children:e.jsx(ve,{children:b==null?void 0:b.filter(s=>!m.some(a=>a.app_id===s.id)).map(s=>e.jsx(J,{value:s.id,children:s.name},s.id))})})]}),e.jsxs(Se,{children:[e.jsx(l,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(l,{className:"btn-primary",onClick:ee,disabled:D===null,children:[e.jsx(De,{}),"Confirm"]})]})]})})})})]})}export{as as ResellerApplications};
