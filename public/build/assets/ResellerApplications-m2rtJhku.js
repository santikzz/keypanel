import{r as t,j as e,K as me,A as pe,t as xe,S as I}from"./app-Bs_WIyy-.js";import{u as ue,F as he,a as D,b as _,c as w,d as E,e as F,s as je,o as fe,n as U,g as z}from"./form-C99kiFqq.js";import{P as V,u as ge,f as Ce,B as C,d as be,t as b}from"./button-Bw4WP5go.js";import{C as ve,a as Ne,b as ye,c as Se,d as Te,e as Ae}from"./card-8PUUqiZC.js";import{T as Pe,a as Re,b as q,c as O,d as De,e as k}from"./table-izU-zNdC.js";import{a as _e,c as we,u as Ee,b as Fe,P as Oe,e as ke,V as v}from"./index-V6ikglT3.js";import{D as K,b as J,c as Q,d as W,e as X,f as Ie}from"./dialog-uCw5_Tle.js";import{I as L}from"./input-CS5EvoHz.js";import{C as Le,S as Y,a as Z,b as ee,c as se,d as ne,e as Me}from"./select-1WNXGI6D.js";import{P as Ve}from"./package-CDpQKST7.js";import{L as P}from"./loader-circle-BwrUoEkx.js";import{T as $e}from"./trash-B9Kcbl7r.js";import{P as M}from"./plus-t5GjCAqi.js";import{C as Be}from"./check-j8P8FGKl.js";import"./label-CQPsWYan.js";import"./index-BAjIOh2N.js";import"./x-sTHOpk9b.js";import"./createLucideIcon-DeoE1KHC.js";import"./index-DOn1mE0_.js";import"./index-egUEx78N.js";import"./index-f_xKbHgU.js";import"./index-D5sH-tFD.js";import"./index-Cdfi8GHL.js";var $="Collapsible",[He,Cs]=we($),[Ge,B]=He($),te=t.forwardRef((n,c)=>{const{__scopeCollapsible:o,open:a,defaultOpen:i,disabled:d,onOpenChange:m,...x}=n,[f=!1,p]=_e({prop:a,defaultProp:i,onChange:m});return e.jsx(Ge,{scope:o,disabled:d,contentId:Ee(),open:f,onOpenToggle:t.useCallback(()=>p(h=>!h),[p]),children:e.jsx(V.div,{"data-state":G(f),"data-disabled":d?"":void 0,...x,ref:c})})});te.displayName=$;var ae="CollapsibleTrigger",ie=t.forwardRef((n,c)=>{const{__scopeCollapsible:o,...a}=n,i=B(ae,o);return e.jsx(V.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":G(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...a,ref:c,onClick:Fe(n.onClick,i.onOpenToggle)})});ie.displayName=ae;var H="CollapsibleContent",re=t.forwardRef((n,c)=>{const{forceMount:o,...a}=n,i=B(H,n.__scopeCollapsible);return e.jsx(Oe,{present:o||i.open,children:({present:d})=>e.jsx(Ue,{...a,ref:c,present:d})})});re.displayName=H;var Ue=t.forwardRef((n,c)=>{const{__scopeCollapsible:o,present:a,children:i,...d}=n,m=B(H,o),[x,f]=t.useState(a),p=t.useRef(null),h=ge(c,p),R=t.useRef(0),N=R.current,y=t.useRef(0),S=y.current,g=m.open||x,T=t.useRef(g),j=t.useRef(void 0);return t.useEffect(()=>{const r=requestAnimationFrame(()=>T.current=!1);return()=>cancelAnimationFrame(r)},[]),ke(()=>{const r=p.current;if(r){j.current=j.current||{transitionDuration:r.style.transitionDuration,animationName:r.style.animationName},r.style.transitionDuration="0s",r.style.animationName="none";const A=r.getBoundingClientRect();R.current=A.height,y.current=A.width,T.current||(r.style.transitionDuration=j.current.transitionDuration,r.style.animationName=j.current.animationName),f(a)}},[m.open,a]),e.jsx(V.div,{"data-state":G(m.open),"data-disabled":m.disabled?"":void 0,id:m.contentId,hidden:!g,...d,ref:h,style:{"--radix-collapsible-content-height":N?`${N}px`:void 0,"--radix-collapsible-content-width":S?`${S}px`:void 0,...n.style},children:g&&i})});function G(n){return n?"open":"closed"}var ze=te;const qe=ze,Ke=ie,Je=re,Qe=fe({name:z().max(24),duration_unit:z(),duration_value:U().gt(0),cost:U().gt(0).default(0)});function bs({reseller:n,applications:c,resellerApps:o}){const a=ue({resolver:je(Qe)}),i=me().props.auth.user,d=i==null?void 0:i.all_permissions.includes("RESELLER_UPDATE"),[m,x]=t.useState(!1),[f,p]=t.useState(!1),[h,R]=t.useState(null),[N,y]=t.useState(null),[S,g]=t.useState(!1),[T,j]=t.useState(!1),[r,A]=t.useState(!1),oe=async s=>{j(!0),p(!1),I.post(route("resellers.addTimeType"),{...s,reseller_app_id:h==null?void 0:h.id},{preserveScroll:!0,onError:()=>{v.error("Error adding time option",{style:b})},onSuccess:()=>{v.success("Time option added",{style:b})},onFinish:()=>{j(!1)}})},le=s=>{A(!0),I.delete(route("resellers.deleteTimeType",s.id),{preserveScroll:!0,onError:()=>{v.error("Error deleting time option",{style:b})},onSuccess:()=>{v.success("Time option deleted",{style:b})},onFinish:()=>{A(!1)}})},ce=()=>{g(!0),x(!1);const s={app_id:N,user_id:n==null?void 0:n.id};I.post(route("resellers.addApp"),s,{preserveScroll:!0,onError:()=>{v.error("Error assigning application",{style:b})},onSuccess:()=>{v.success("Application assigned",{style:b})},onFinish:()=>{g(!1),y(null)}})},de=s=>{R(s),p(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(ve,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Application Access"}),e.jsx(Se,{children:"Manage reseller access to applications and license creation options"})]}),e.jsx(pe,{data:"resellerApps",fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-indigo-600"})}),children:e.jsx(Te,{className:"space-y-4",children:o==null?void 0:o.map(s=>{var l;return e.jsxs(qe,{className:"border rounded-md",children:[e.jsxs(Ke,{className:"flex items-center justify-between w-full p-4 font-medium",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),s.app.name]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Le,{className:"h-4 w-4 transition-transform duration-200"})})]}),e.jsx(Je,{className:"px-4 pb-4 pt-0 space-y-2",children:e.jsxs(e.Fragment,{children:[e.jsxs(Pe,{children:[e.jsx(Re,{children:e.jsxs(q,{children:[e.jsx(O,{children:"Name"}),e.jsx(O,{children:"Duration (days)"}),e.jsx(O,{children:"Cost"}),e.jsx(O,{className:"text-right",children:"Action"})]})}),e.jsx(De,{children:(l=s.time_types)==null?void 0:l.map(u=>e.jsxs(q,{children:[e.jsx(k,{children:u.name}),e.jsx(k,{children:Ce(u.duration)}),e.jsxs(k,{children:["$",u.cost]}),e.jsx(k,{className:"text-right",children:e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>le(u),disabled:r||!d,children:r?e.jsx(P,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx($e,{className:"h-4 w-4 text-rose-600"})})})]},u.id))})]}),e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>de(s),disabled:T||!d,children:[T?e.jsx(P,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(M,{className:"h-4 w-4 mr-2"}),"Add Time Option"]})]})})]},s.id)})})}),e.jsx(Ae,{children:e.jsxs(C,{className:"btn-primary",onClick:()=>x(!0),disabled:S||!d,children:[S?e.jsx(P,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(M,{}),"Assign Application"]})})]}),e.jsx(K,{open:f,onOpenChange:p,children:e.jsxs(J,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Add Time Option"}),e.jsx(X,{children:"Add a new time option"})]}),e.jsx(he,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(oe),className:"flex flex-col gap-4",children:[e.jsx(D,{control:a.control,name:"name",render:({field:s})=>e.jsxs(_,{children:[e.jsx(w,{children:"Name *"}),e.jsx(E,{children:e.jsx(L,{placeholder:"e.g., 1 Month",type:"text",...s})}),e.jsx(F,{})]})}),e.jsx(D,{control:a.control,name:"duration_unit",render:({field:s})=>e.jsxs(_,{className:"flex flex-col flex-1 mt-2.5",children:[e.jsx(w,{children:"Duration Unit *"}),e.jsxs(Y,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(E,{children:e.jsx(Z,{children:e.jsx(ee,{placeholder:"Select a time unit"})})}),e.jsx(se,{children:be.map(l=>e.jsx(ne,{value:l.value,children:l.label},l.value))})]}),e.jsx(F,{})]})}),e.jsx(D,{control:a.control,name:"duration_value",render:({field:s})=>e.jsxs(_,{className:"flex-1",children:[e.jsx(w,{children:"Duration Value *"}),e.jsx(E,{children:e.jsx(L,{placeholder:"Enter a duration value",type:"number",...s,onChange:l=>s.onChange(Number(l.target.value)||0)})}),e.jsx(F,{})]})}),e.jsx(D,{control:a.control,name:"cost",render:({field:s})=>e.jsxs(_,{children:[e.jsx(w,{children:"Cost *"}),e.jsx(E,{children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"peer ps-6 pe-12",placeholder:"0.00",type:"number",step:"0.01",min:"0.00",...s,value:(s.value??0).toFixed(2),onChange:l=>{const u=parseFloat(l.target.value);s.onChange(isNaN(u)?0:u)}}),e.jsx("span",{className:"text-muted-foreground pointer-events-none absolute inset-y-0 start-0 flex items-center justify-center ps-3 text-sm peer-disabled:opacity-50",children:"$"})]})}),e.jsx(F,{})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(C,{type:"submit",className:"btn-primary",children:[e.jsx(M,{}),"Confirm"]})})]})})]})}),e.jsx(K,{open:m,onOpenChange:x,children:e.jsx(J,{children:e.jsx(xe,{data:"applications",fallback:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-indigo-600"})}),children:e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Assign Application"}),e.jsxs(X,{children:["Assign an application to ",n==null?void 0:n.name]})]}),e.jsxs(Y,{onValueChange:y,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Select an application"})}),e.jsx(se,{children:e.jsx(Me,{children:c==null?void 0:c.filter(s=>!o.some(l=>l.app_id===s.id)).map(s=>e.jsx(ne,{value:s.id,children:s.name},s.id))})})]}),e.jsxs(Ie,{children:[e.jsx(C,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(C,{className:"btn-primary",onClick:ce,disabled:N===null,children:[e.jsx(Be,{}),"Confirm"]})]})]})})})})]})}export{bs as ResellerApplications};
